{% extends "layout.html" %}

{% block title %}
Add new recipe
{% endblock %}

{% block content %}

<h2>Add new recipe</h2>
{% if alert %}
    <p class=error><strong>Error:</strong> {{ alert }} </p>
{% endif %}

<form method="POST" action="/new_recipe">
    {{form.name.label}}<br>
    {{ form.name() }} <br><br>
    {{form.instructions.label}}<br>
    {{ form.instructions() }} <br><br>
    {{ form.ingredients.label }}<br>
    {{ form.ingredients() }}<br>
    <button type="submit">Save</button>
    <button id="add-ingredient-field" type="button">Add new ingredient</button>
</form>


<script>
    window.onload = function() {
        let addIngredientFieldBtn = document.getElementById('add-ingredient-field');
        addIngredientFieldBtn.addEventListener('click', function(e){
            e.preventDefault();
            let allIngredientsFieldWrapper = document.getElementById('ingredients');
            let allIngredientsField = allIngredientsFieldWrapper.getElementsByTagName('input');
            if(allIngredientsField.length > 4) {
                alert('You can have maximum fifteen ingredients');
                return;
            }
            let ingredientInputIds = []
            for(let i = 0; i < allIngredientsField.length; i++) {
                ingredientInputIds.push(parseInt(allIngredientsField[i].name.split('-')[1]));
            }
            let newFieldName = `ingredients-${Math.max(...ingredientInputIds) + 1}`;
            allIngredientsFieldWrapper.insertAdjacentHTML('beforeend',`
            <li><label for="${newFieldName}"></label> <input id="${newFieldName}" name="${newFieldName}" type="text" value=""></li> 
            `);
        });
    }
</script>
{% endblock %}